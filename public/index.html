
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Parth Patil's Blog</title>
  <meta name="author" content="Parth Patil">

  
  <meta name="description" content="I have written a small library in Scala to allow periodic sending of JVM stats to StatsD server. One can include it in server written in Scala so &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://parth-patil.github.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Parth Patil's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-4311521-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Parth Patil's Blog</a></h1>
  
    <h2>Programming, Hacks etc.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:parth-patil.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/01/periodically-sending-jvm-stats-to-statsd-in-scala/">Periodically Sending JVM Stats to StatsD in Scala</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-01T15:10:00-08:00" pubdate data-updated="true">Jan 1<span>st</span>, 2014</time>
        
         | <a href="/blog/2014/01/01/periodically-sending-jvm-stats-to-statsd-in-scala/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have written a small library in Scala to allow periodic sending of JVM stats to StatsD server. One can include it in server written in Scala so that its JVM stats can be monitored over time. I am using the following <a href="https://github.com/etsy/statsd/blob/master/examples/StatsD.scala">Scala class</a> to send the stats to StatsD. Also the technique to extract JVM stats is borrowed from twitter&rsquo;s excellent <a href="https://github.com/twitter/ostrich">Ostrich library</a></p>

<p>Following is the class that schedules sending of the stats periodically</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">package</span> <span class="nn">com.parthpatil.jvmstatsd</span>
</span><span class='line'>
</span><span class='line'><span class="k">import</span> <span class="nn">scala.collection.mutable</span>
</span><span class='line'><span class="k">import</span> <span class="nn">java.util.concurrent.</span><span class="o">{</span><span class="nc">TimeUnit</span><span class="o">,</span> <span class="nc">Executors</span><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">StatsSender</span><span class="o">(</span><span class="n">statsd</span><span class="k">:</span> <span class="kt">StatsD</span><span class="o">,</span> <span class="n">numSchedulerThreads</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="c1">// Tasks that need to be scheduled to send stats to statsd</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">val</span> <span class="n">tasks</span> <span class="k">=</span> <span class="n">mutable</span><span class="o">.</span><span class="nc">ArrayBuffer</span><span class="o">[(</span><span class="kt">StatsTask</span>, <span class="kt">Int</span><span class="o">)]()</span>
</span><span class='line'>  <span class="k">val</span> <span class="n">fScheduler</span>    <span class="k">=</span> <span class="nc">Executors</span><span class="o">.</span><span class="n">newScheduledThreadPool</span><span class="o">(</span><span class="n">numSchedulerThreads</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">addTask</span><span class="o">(</span><span class="n">task</span><span class="k">:</span> <span class="kt">StatsTask</span><span class="o">,</span> <span class="n">secs</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">task</span><span class="o">.</span><span class="n">setStatsD</span><span class="o">(</span><span class="n">statsd</span><span class="o">)</span>
</span><span class='line'>    <span class="n">tasks</span> <span class="o">+=</span> <span class="o">((</span><span class="n">task</span><span class="o">,</span> <span class="n">secs</span><span class="o">))</span>
</span><span class='line'>    <span class="n">fScheduler</span><span class="o">.</span><span class="n">scheduleWithFixedDelay</span><span class="o">(</span><span class="n">task</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">secs</span><span class="o">,</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="nc">SECONDS</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">getTasks</span><span class="o">()</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[(</span><span class="kt">StatsTask</span>, <span class="kt">Int</span><span class="o">)]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">tasks</span><span class="o">.</span><span class="n">toSeq</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Following is the interface base class for a stats task that publishes stats to StatsD using the StatsD class</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">package</span> <span class="nn">com.parthpatil.jvmstatsd</span>
</span><span class='line'>
</span><span class='line'><span class="k">import</span> <span class="nn">java.text.DecimalFormat</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">StatsTask</span><span class="o">()</span> <span class="k">extends</span> <span class="nc">Runnable</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">var</span> <span class="n">statsd</span><span class="k">:</span> <span class="kt">StatsD</span> <span class="o">=</span> <span class="kc">null</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// formatter to remove scientific notation from doubles</span>
</span><span class='line'>  <span class="k">val</span> <span class="n">formatter</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">DecimalFormat</span><span class="o">(</span><span class="s">&quot;#&quot;</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">override</span> <span class="k">def</span> <span class="n">run</span><span class="o">()</span> <span class="o">{</span> <span class="o">}</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">setStatsD</span><span class="o">(</span><span class="n">sd</span><span class="k">:</span> <span class="kt">StatsD</span><span class="o">)</span> <span class="o">{</span> <span class="n">statsd</span> <span class="k">=</span> <span class="n">sd</span> <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Following is a sample implementation of the StatsTask that publishes JVM stats. You can write your won periodic stats publisher by extending StatsTask and adding it to StatsSender via addTask() method.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">package</span> <span class="nn">com.parthpatil.jvmstatsd</span>
</span><span class='line'>
</span><span class='line'><span class="k">import</span> <span class="nn">java.lang.management.ManagementFactory</span>
</span><span class='line'><span class="k">import</span> <span class="nn">scala.collection.mutable</span>
</span><span class='line'><span class="k">import</span> <span class="nn">scala.collection.JavaConverters._</span>
</span><span class='line'><span class="k">import</span> <span class="nn">com.twitter.conversions.string._</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">JvmStatsTask</span> <span class="k">extends</span> <span class="nc">StatsTask</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">override</span> <span class="k">def</span> <span class="n">run</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">getJvmGauges</span><span class="o">()</span> <span class="n">foreach</span> <span class="o">{</span> <span class="k">case</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span>  <span class="k">=&gt;</span> <span class="n">statsd</span><span class="o">.</span><span class="n">gauge</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format</span><span class="o">(</span><span class="n">v</span><span class="o">))</span> <span class="o">}</span>
</span><span class='line'>    <span class="n">getJvmCounters</span><span class="o">()</span> <span class="n">foreach</span> <span class="o">{</span> <span class="k">case</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span><span class="n">v</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">statsd</span><span class="o">.</span><span class="n">increment</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">getJvmGauges</span><span class="o">()</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">out</span> <span class="k">=</span> <span class="n">mutable</span><span class="o">.</span><span class="nc">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">]()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">mem</span> <span class="k">=</span> <span class="nc">ManagementFactory</span><span class="o">.</span><span class="n">getMemoryMXBean</span><span class="o">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">heap</span> <span class="k">=</span> <span class="n">mem</span><span class="o">.</span><span class="n">getHeapMemoryUsage</span><span class="o">()</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.heap.committed&quot;</span> <span class="o">-&gt;</span> <span class="n">heap</span><span class="o">.</span><span class="n">getCommitted</span><span class="o">())</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.heap.max&quot;</span> <span class="o">-&gt;</span> <span class="n">heap</span><span class="o">.</span><span class="n">getMax</span><span class="o">())</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.heap.used&quot;</span> <span class="o">-&gt;</span> <span class="n">heap</span><span class="o">.</span><span class="n">getUsed</span><span class="o">())</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">nonheap</span> <span class="k">=</span> <span class="n">mem</span><span class="o">.</span><span class="n">getNonHeapMemoryUsage</span><span class="o">()</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.nonheap.committed&quot;</span> <span class="o">-&gt;</span> <span class="n">nonheap</span><span class="o">.</span><span class="n">getCommitted</span><span class="o">())</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.nonheap.max&quot;</span> <span class="o">-&gt;</span> <span class="n">nonheap</span><span class="o">.</span><span class="n">getMax</span><span class="o">())</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.nonheap.used&quot;</span> <span class="o">-&gt;</span> <span class="n">nonheap</span><span class="o">.</span><span class="n">getUsed</span><span class="o">())</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">threads</span> <span class="k">=</span> <span class="nc">ManagementFactory</span><span class="o">.</span><span class="n">getThreadMXBean</span><span class="o">()</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.thread.daemon_count&quot;</span> <span class="o">-&gt;</span> <span class="n">threads</span><span class="o">.</span><span class="n">getDaemonThreadCount</span><span class="o">().</span><span class="n">toLong</span><span class="o">)</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.thread.count&quot;</span> <span class="o">-&gt;</span> <span class="n">threads</span><span class="o">.</span><span class="n">getThreadCount</span><span class="o">().</span><span class="n">toLong</span><span class="o">)</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.thread.peak_count&quot;</span> <span class="o">-&gt;</span> <span class="n">threads</span><span class="o">.</span><span class="n">getPeakThreadCount</span><span class="o">().</span><span class="n">toLong</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">runtime</span> <span class="k">=</span> <span class="nc">ManagementFactory</span><span class="o">.</span><span class="n">getRuntimeMXBean</span><span class="o">()</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.start_time&quot;</span> <span class="o">-&gt;</span> <span class="n">runtime</span><span class="o">.</span><span class="n">getStartTime</span><span class="o">())</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.uptime&quot;</span> <span class="o">-&gt;</span> <span class="n">runtime</span><span class="o">.</span><span class="n">getUptime</span><span class="o">())</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">os</span> <span class="k">=</span> <span class="nc">ManagementFactory</span><span class="o">.</span><span class="n">getOperatingSystemMXBean</span><span class="o">()</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.num_cpus&quot;</span> <span class="o">-&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">getAvailableProcessors</span><span class="o">().</span><span class="n">toLong</span><span class="o">)</span>
</span><span class='line'>    <span class="n">os</span> <span class="k">match</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="n">unix</span><span class="k">:</span> <span class="kt">com.sun.management.UnixOperatingSystemMXBean</span> <span class="o">=&gt;</span>
</span><span class='line'>        <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.fd.count&quot;</span> <span class="o">-&gt;</span> <span class="n">unix</span><span class="o">.</span><span class="n">getOpenFileDescriptorCount</span><span class="o">)</span>
</span><span class='line'>        <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.fd.limit&quot;</span> <span class="o">-&gt;</span> <span class="n">unix</span><span class="o">.</span><span class="n">getMaxFileDescriptorCount</span><span class="o">)</span>
</span><span class='line'>      <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span>   <span class="c1">// ew, Windows... or something</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">var</span> <span class="n">postGCTotalUsage</span> <span class="k">=</span> <span class="mi">0L</span>
</span><span class='line'>    <span class="k">var</span> <span class="n">currentTotalUsage</span> <span class="k">=</span> <span class="mi">0L</span>
</span><span class='line'>    <span class="nc">ManagementFactory</span><span class="o">.</span><span class="n">getMemoryPoolMXBeans</span><span class="o">().</span><span class="n">asScala</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="n">pool</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">name</span> <span class="k">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">getName</span><span class="o">.</span><span class="n">regexSub</span><span class="o">(</span><span class="s">&quot;&quot;&quot;[^\w]&quot;&quot;&quot;</span><span class="o">.</span><span class="n">r</span><span class="o">)</span> <span class="o">{</span> <span class="n">m</span> <span class="k">=&gt;</span> <span class="s">&quot;.&quot;</span> <span class="o">}</span>
</span><span class='line'>      <span class="nc">Option</span><span class="o">(</span><span class="n">pool</span><span class="o">.</span><span class="n">getCollectionUsage</span><span class="o">).</span><span class="n">foreach</span> <span class="o">{</span> <span class="n">usage</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.post_gc.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.used&quot;</span> <span class="o">-&gt;</span> <span class="n">usage</span><span class="o">.</span><span class="n">getUsed</span><span class="o">)</span>
</span><span class='line'>        <span class="n">postGCTotalUsage</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">getUsed</span>
</span><span class='line'>        <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.post_gc.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.max&quot;</span> <span class="o">-&gt;</span> <span class="n">usage</span><span class="o">.</span><span class="n">getMax</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="nc">Option</span><span class="o">(</span><span class="n">pool</span><span class="o">.</span><span class="n">getUsage</span><span class="o">)</span> <span class="n">foreach</span> <span class="o">{</span> <span class="n">usage</span> <span class="k">=&gt;</span>
</span><span class='line'>        <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.current_mem.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.used&quot;</span> <span class="o">-&gt;</span> <span class="n">usage</span><span class="o">.</span><span class="n">getUsed</span><span class="o">)</span>
</span><span class='line'>        <span class="n">currentTotalUsage</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">getUsed</span>
</span><span class='line'>        <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.current_mem.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.max&quot;</span> <span class="o">-&gt;</span> <span class="n">usage</span><span class="o">.</span><span class="n">getMax</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.post_gc.used&quot;</span> <span class="o">-&gt;</span> <span class="n">postGCTotalUsage</span><span class="o">)</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.current_mem.used&quot;</span> <span class="o">-&gt;</span> <span class="n">currentTotalUsage</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">out</span><span class="o">.</span><span class="n">toMap</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">getJvmCounters</span><span class="o">()</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">out</span> <span class="k">=</span> <span class="n">mutable</span><span class="o">.</span><span class="nc">Map</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">Long</span><span class="o">]()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">var</span> <span class="n">totalCycles</span> <span class="k">=</span> <span class="mi">0L</span>
</span><span class='line'>    <span class="k">var</span> <span class="n">totalTime</span> <span class="k">=</span> <span class="mi">0L</span>
</span><span class='line'>
</span><span class='line'>    <span class="nc">ManagementFactory</span><span class="o">.</span><span class="n">getGarbageCollectorMXBeans</span><span class="o">().</span><span class="n">asScala</span><span class="o">.</span><span class="n">foreach</span> <span class="o">{</span> <span class="n">gc</span> <span class="k">=&gt;</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">name</span> <span class="k">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">getName</span><span class="o">.</span><span class="n">regexSub</span><span class="o">(</span><span class="s">&quot;&quot;&quot;[^\w]&quot;&quot;&quot;</span><span class="o">.</span><span class="n">r</span><span class="o">)</span> <span class="o">{</span> <span class="n">m</span> <span class="k">=&gt;</span> <span class="s">&quot;.&quot;</span> <span class="o">}</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">collectionCount</span> <span class="k">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">getCollectionCount</span>
</span><span class='line'>      <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.gc.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.cycles&quot;</span> <span class="o">-&gt;</span> <span class="n">collectionCount</span><span class="o">)</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">collectionTime</span> <span class="k">=</span> <span class="n">gc</span><span class="o">.</span><span class="n">getCollectionTime</span>
</span><span class='line'>      <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.gc.&quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&quot;.msec&quot;</span> <span class="o">-&gt;</span> <span class="n">collectionTime</span><span class="o">)</span>
</span><span class='line'>      <span class="c1">// note, these could be -1 if the collector doesn&#39;t have support for it.</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">collectionCount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
</span><span class='line'>        <span class="n">totalCycles</span> <span class="o">+=</span> <span class="n">collectionCount</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">collectionTime</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
</span><span class='line'>        <span class="n">totalTime</span> <span class="o">+=</span> <span class="n">gc</span><span class="o">.</span><span class="n">getCollectionTime</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.gc.cycles&quot;</span> <span class="o">-&gt;</span> <span class="n">totalCycles</span><span class="o">)</span>
</span><span class='line'>    <span class="n">out</span> <span class="o">+=</span> <span class="o">(</span><span class="s">&quot;jvm.gc.msec&quot;</span> <span class="o">-&gt;</span> <span class="n">totalTime</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">out</span><span class="o">.</span><span class="n">toMap</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Sample Usage</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">package</span> <span class="nn">com.parthpatil.jvmstatsd</span>
</span><span class='line'>
</span><span class='line'><span class="k">import</span> <span class="nn">akka.actor.ActorSystem</span>
</span><span class='line'><span class="k">import</span> <span class="nn">scala.concurrent.ExecutionContext.Implicits.global</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">SampleUsage</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">actorSystem</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="s">&quot;statsd-actor-system&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">statsD</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StatsD</span><span class="o">(</span>
</span><span class='line'>      <span class="n">context</span> <span class="k">=</span> <span class="n">actorSystem</span><span class="o">,</span>
</span><span class='line'>      <span class="n">host</span> <span class="k">=</span> <span class="s">&quot;localhost&quot;</span><span class="o">,</span>
</span><span class='line'>      <span class="n">port</span> <span class="k">=</span> <span class="mi">8192</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">val</span> <span class="n">statsSender</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">StatsSender</span><span class="o">(</span><span class="n">statsD</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Create the JvmStatsTask that publishes stats every 10 secs</span>
</span><span class='line'>    <span class="n">statsSender</span><span class="o">.</span><span class="n">addTask</span><span class="o">(</span><span class="n">task</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">JvmStatsTask</span><span class="o">,</span> <span class="n">secs</span> <span class="k">=</span> <span class="mi">10</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can find the full source in this <a href="https://github.com/parth-patil/JvmStatsD">repo</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/21/using-bitsets-for-user-analytics/">Using BitSets for User Analytics</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-21T23:55:00-07:00" pubdate data-updated="true">Mar 21<span>st</span>, 2013</time>
        
         | <a href="/blog/2013/03/21/using-bitsets-for-user-analytics/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I read about a neat trick to do user analytics using Redis BitSets in <a href="http://blog.getspool.com/2011/11/29/fast-easy-realtime-metrics-using-redis-bitmaps/">this article</a>
And I thought to hack up a simple finagle(finatra) based service that provides an API to do this kind of user analytics without needing Redis.</p>

<p>For BitSets I used the <a href="https://code.google.com/p/javaewah/">javaewah library</a></p>

<p>So I have started a small project called cardino-db and you can check the source code <a href="https://github.com/parth-patil/cardino-db">here</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/18/implementing-iterator-design-pattern-in-scala/">Implementing Iterator Design Pattern in Scala</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-18T22:32:00-08:00" pubdate data-updated="true">Jan 18<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/18/implementing-iterator-design-pattern-in-scala/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The other day I came across a puzzle that involved implementing a spreadsheet class. Like a
regular spreadsheet the cells were referenced as A1, A2 etc .. I wanted to iterate the cells
in the spreadsheet. My first stab at the implementation looked as follows</p>

<figure class='code'><figcaption><span>Spreadsheet iteration v1</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">scala.collection.mutable</span>
</span><span class='line'>
</span><span class='line'><span class="k">object</span> <span class="nc">IteratorTest</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">height</span> <span class="k">=</span> <span class="mi">4</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">width</span> <span class="k">=</span> <span class="mi">4</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">ss</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SpreadsheetV1</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">)</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="n">i</span> <span class="k">&lt;-</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">for</span> <span class="o">(</span><span class="n">j</span> <span class="k">&lt;-</span> <span class="mi">0</span> <span class="n">until</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">val</span> <span class="n">id</span> <span class="k">=</span> <span class="nc">Spreadsheet</span><span class="o">.</span><span class="n">getIdFromRowAndCol</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="n">j</span><span class="o">)</span>
</span><span class='line'>        <span class="n">println</span><span class="o">(</span><span class="s">&quot;id = &quot;</span> <span class="o">+</span> <span class="n">id</span><span class="o">)</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">SpreadsheetV1</span><span class="o">(</span><span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">height</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">.</span><span class="n">ofDim</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">height</span><span class="o">,</span> <span class="n">width</span><span class="o">)</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">get</span><span class="o">(</span><span class="n">i</span><span class="k">:</span><span class="kt">Int</span><span class="o">,</span> <span class="n">j</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="n">data</span><span class="o">(</span><span class="n">i</span><span class="o">)(</span><span class="n">j</span><span class="o">)</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">set</span><span class="o">(</span><span class="n">i</span><span class="k">:</span><span class="kt">Int</span><span class="o">,</span> <span class="n">j</span><span class="k">:</span><span class="kt">Int</span><span class="o">,</span> <span class="n">value</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span> <span class="n">data</span><span class="o">(</span><span class="n">i</span><span class="o">)(</span><span class="n">j</span><span class="o">)</span> <span class="k">=</span> <span class="n">value</span> <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">object</span> <span class="nc">Spreadsheet</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">val</span> <span class="nc">Coordinates</span> <span class="k">=</span> <span class="s">&quot;&quot;&quot;([A-Z])(\d+)&quot;&quot;&quot;</span><span class="o">.</span><span class="n">r</span>
</span><span class='line'>  <span class="k">val</span> <span class="n">asciiValueForA</span> <span class="k">=</span> <span class="-Symbol">&#39;A</span><span class="err">&#39;</span><span class="o">.</span><span class="n">toInt</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Given a cell id retuns the row and col as tuple</span>
</span><span class='line'><span class="cm">   * eg. A2 -&gt; (0, 1)</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">getRowAndColFromId</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="o">(</span><span class="kt">Int</span><span class="o">,</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="nc">Coordinates</span><span class="o">(</span><span class="n">row</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">col</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="n">id</span> <span class="c1">// apply the regex to extract row &amp; col</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Now convert these to actual Int indexes in our 2d array</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">realRow</span> <span class="k">=</span> <span class="n">row</span><span class="o">.</span><span class="n">toCharArray</span><span class="o">()(</span><span class="mi">0</span><span class="o">).</span><span class="n">toInt</span> <span class="o">-</span> <span class="n">asciiValueForA</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">realCol</span> <span class="k">=</span> <span class="n">col</span><span class="o">.</span><span class="n">toInt</span> <span class="o">-</span><span class="mi">1</span>
</span><span class='line'>    <span class="o">(</span><span class="n">realRow</span><span class="o">,</span> <span class="n">realCol</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * Given row and col returns id</span>
</span><span class='line'><span class="cm">   * eg (0,0) =&gt; A1, (0,1) =&gt; A2 etc</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">getIdFromRowAndCol</span><span class="o">(</span><span class="n">row</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">col</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">(</span><span class="n">asciiValueForA</span> <span class="o">+</span> <span class="n">row</span><span class="o">).</span><span class="n">toChar</span> <span class="o">+</span> <span class="o">(</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="o">).</span><span class="n">toString</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>But its possible to have a nicer interface to iterate over the cells by implementing Iterator
trait. It also results in better encapsulation of the internal structure of the Spreadsheet
class. Following is an implementation of Spreadsheet class with Iterator trait.</p>

<figure class='code'><figcaption><span>Spreadsheet iteration v2</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">scala.collection.mutable</span>
</span><span class='line'>
</span><span class='line'><span class="k">object</span> <span class="nc">IteratorTest</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">height</span> <span class="k">=</span> <span class="mi">4</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">width</span> <span class="k">=</span> <span class="mi">4</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">ss</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SpreadsheetV2</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">)</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="n">id</span> <span class="k">&lt;-</span> <span class="n">ss</span><span class="o">)</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">SpreadsheetV2</span><span class="o">(</span><span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">height</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Iterator</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">Spreadsheet._</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">.</span><span class="n">ofDim</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">height</span><span class="o">,</span> <span class="n">width</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">get</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="o">(</span><span class="n">row</span><span class="o">,</span> <span class="n">col</span><span class="o">)</span> <span class="k">=</span> <span class="n">getRowAndColFromId</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
</span><span class='line'>    <span class="n">data</span><span class="o">(</span><span class="n">row</span><span class="o">)(</span><span class="n">col</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">set</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">value</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="o">(</span><span class="n">row</span><span class="o">,</span> <span class="n">col</span><span class="o">)</span> <span class="k">=</span> <span class="n">getRowAndColFromId</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
</span><span class='line'>    <span class="n">data</span><span class="o">(</span><span class="n">row</span><span class="o">)(</span><span class="n">col</span><span class="o">)</span>  <span class="k">=</span> <span class="n">value</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//------------------------</span>
</span><span class='line'>  <span class="c1">// Iterator Implementation</span>
</span><span class='line'>  <span class="c1">//------------------------</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">var</span> <span class="nc">_nextRow</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">var</span> <span class="nc">_nextCol</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">var</span> <span class="nc">_next</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="kc">null</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">hasNext</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="nc">_next</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
</span><span class='line'>      <span class="kc">true</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">computeNext</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">next</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">hasNext</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="nc">_next</span>
</span><span class='line'>      <span class="nc">_next</span> <span class="k">=</span> <span class="kc">null</span>
</span><span class='line'>      <span class="n">result</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">throw</span> <span class="k">new</span> <span class="nc">NoSuchElementException</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">def</span> <span class="n">computeNext</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="nc">_nextRow</span> <span class="o">&lt;</span> <span class="n">height</span> <span class="o">&amp;&amp;</span> <span class="nc">_nextCol</span> <span class="o">&lt;</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="nc">_next</span> <span class="k">=</span> <span class="n">getIdFromRowAndCol</span><span class="o">(</span><span class="nc">_nextRow</span><span class="o">,</span> <span class="nc">_nextCol</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="nc">_nextCol</span> <span class="o">==</span> <span class="o">(</span><span class="n">width</span> <span class="o">-</span><span class="mi">1</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>        <span class="nc">_nextCol</span> <span class="k">=</span> <span class="mi">0</span>
</span><span class='line'>        <span class="nc">_nextRow</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        <span class="nc">_nextCol</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="kc">true</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>      <span class="kc">false</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The iterator code is not a core part of the Spreadsheet&rsquo;s logic so there is no need for the
Spreadsheet class to directly implement Iterator. The iterator implementation can be moved out
into a separate class and the Spreadsheet class&rsquo;s implementation can be kept simple.</p>

<figure class='code'><figcaption><span>Spreadsheet iteration v3</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="k">import</span> <span class="nn">scala.collection.mutable</span>
</span><span class='line'>
</span><span class='line'><span class="k">object</span> <span class="nc">IteratorTest</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">def</span> <span class="n">main</span><span class="o">(</span><span class="n">args</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">height</span> <span class="k">=</span> <span class="mi">4</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">width</span> <span class="k">=</span> <span class="mi">4</span>
</span><span class='line'>    <span class="k">val</span> <span class="n">ss</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">SpreadsheetV3</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">)</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="n">id</span> <span class="k">&lt;-</span> <span class="n">ss</span><span class="o">.</span><span class="n">getIterator</span><span class="o">)</span>
</span><span class='line'>      <span class="n">println</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">SpreadsheetV3</span><span class="o">(</span><span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">height</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">Spreadsheet._</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="nc">Array</span><span class="o">.</span><span class="n">ofDim</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">height</span><span class="o">,</span> <span class="n">width</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">get</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="o">(</span><span class="n">row</span><span class="o">,</span> <span class="n">col</span><span class="o">)</span> <span class="k">=</span> <span class="n">getRowAndColFromId</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
</span><span class='line'>    <span class="n">data</span><span class="o">(</span><span class="n">row</span><span class="o">)(</span><span class="n">col</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">set</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">value</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">val</span> <span class="o">(</span><span class="n">row</span><span class="o">,</span> <span class="n">col</span><span class="o">)</span> <span class="k">=</span> <span class="n">getRowAndColFromId</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>
</span><span class='line'>    <span class="n">data</span><span class="o">(</span><span class="n">row</span><span class="o">)(</span><span class="n">col</span><span class="o">)</span>  <span class="k">=</span> <span class="n">value</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">getIterator</span><span class="o">()</span><span class="k">:</span> <span class="kt">Iterator</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">new</span> <span class="nc">SpreadsheetIterator</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">)</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">SpreadsheetIterator</span><span class="o">(</span><span class="n">width</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">height</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Iterator</span> <span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="o">{</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">Spreadsheet._</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">//------------------------</span>
</span><span class='line'>  <span class="c1">// Iterator Implementation</span>
</span><span class='line'>  <span class="c1">//------------------------</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">var</span> <span class="nc">_nextRow</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">var</span> <span class="nc">_nextCol</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">var</span> <span class="nc">_next</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="kc">null</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">hasNext</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="nc">_next</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
</span><span class='line'>      <span class="kc">true</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">computeNext</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="n">next</span> <span class="k">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">hasNext</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">val</span> <span class="n">result</span> <span class="k">=</span> <span class="nc">_next</span>
</span><span class='line'>      <span class="nc">_next</span> <span class="k">=</span> <span class="kc">null</span>
</span><span class='line'>      <span class="n">result</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">throw</span> <span class="k">new</span> <span class="nc">NoSuchElementException</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">def</span> <span class="n">computeNext</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="nc">_nextRow</span> <span class="o">&lt;</span> <span class="n">height</span> <span class="o">&amp;&amp;</span> <span class="nc">_nextCol</span> <span class="o">&lt;</span> <span class="n">width</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="nc">_next</span> <span class="k">=</span> <span class="n">getIdFromRowAndCol</span><span class="o">(</span><span class="nc">_nextRow</span><span class="o">,</span> <span class="nc">_nextCol</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="nc">_nextCol</span> <span class="o">==</span> <span class="o">(</span><span class="n">width</span> <span class="o">-</span><span class="mi">1</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>        <span class="nc">_nextCol</span> <span class="k">=</span> <span class="mi">0</span>
</span><span class='line'>        <span class="nc">_nextRow</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>        <span class="nc">_nextCol</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="kc">true</span>
</span><span class='line'>    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>      <span class="kc">false</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/10/custom-functions-in-hbase-shell/">Custom Functions in HBase Shell</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-10T09:04:00-08:00" pubdate data-updated="true">Jan 10<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/10/custom-functions-in-hbase-shell/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As many of you might know that the HBase shell is a jruby repl. So you can write ruby code in the
shell. You can also save your custom ruby functions in <code>~/.irbrc</code> and the next time you
start the hbase shell those functions will be available to you. At work I often need
to truncate a bunch of HBase tables before I can begin my testing. I wanted to automate
this. So I wrote the following custom function to truncate a list of tables and added
it to my <code>~/.irbrc</code></p>

<figure class='code'><figcaption><span>HBase shell custom function</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">truncate_tables</span><span class="p">()</span>
</span><span class='line'>  <span class="n">tables</span> <span class="o">=</span> <span class="o">[</span>
</span><span class='line'>    <span class="s1">&#39;table1&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;table2&#39;</span><span class="p">,</span>
</span><span class='line'>    <span class="s1">&#39;table3&#39;</span>
</span><span class='line'>  <span class="o">]</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">tables</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">truncate</span> <span class="n">x</span><span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>You have to restart your HBase shell for this function to be available in the shell.
Now this custom function can be invoked from the shell as follows</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ruby-1.9.2-p136 :001 > truncate_tables</span></code></pre></td></tr></table></div></figure>


<p>For more information refer to the following links:</p>

<p><a href="http://wiki.apache.org/hadoop/Hbase/Shell">HBase Wiki</a></p>

<p><a href="http://stackoverflow.com/questions/7256100/how-to-scan-hbase-from-hbase-shell-using-filter">Stack Overflow Question</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/09/group-anagram-puzzle-in-various-programming-languages/">Group Anagram Puzzle in Various Programming Languages</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-09T22:13:00-08:00" pubdate data-updated="true">Jan 9<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/09/group-anagram-puzzle-in-various-programming-languages/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><figcaption><span>Group Anagrams [Java]</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// Minus the boilerplate code</span>
</span><span class='line'><span class="n">String</span><span class="o">[]</span> <span class="n">words</span> <span class="o">=</span> <span class="o">{</span><span class="s">&quot;abc&quot;</span><span class="o">,</span> <span class="s">&quot;bca&quot;</span><span class="o">,</span> <span class="s">&quot;mkzp&quot;</span><span class="o">,</span> <span class="s">&quot;cba&quot;</span><span class="o">};</span>
</span><span class='line'>
</span><span class='line'><span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;</span> <span class="n">groups</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;&gt;();</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="nl">w:</span> <span class="n">words</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>  <span class="kt">char</span><span class="o">[]</span> <span class="n">chars</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="na">toCharArray</span><span class="o">();</span>
</span><span class='line'>  <span class="n">Arrays</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">chars</span><span class="o">);</span>
</span><span class='line'>  <span class="n">String</span> <span class="n">normalized</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">(</span><span class="n">chars</span><span class="o">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="o">(!</span><span class="n">groups</span><span class="o">.</span><span class="na">containsKey</span><span class="o">(</span><span class="n">normalized</span><span class="o">))</span>
</span><span class='line'>    <span class="n">groups</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">normalized</span><span class="o">,</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;());</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">groups</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">normalized</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="n">w</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Group Anagrams [Scala]</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='scala'><span class='line'><span class="c1">// Minus the boilerplate code</span>
</span><span class='line'><span class="k">val</span> <span class="n">words</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span><span class="s">&quot;abc&quot;</span><span class="o">,</span> <span class="s">&quot;bca&quot;</span><span class="o">,</span> <span class="s">&quot;mkzp&quot;</span><span class="o">,</span> <span class="s">&quot;cba&quot;</span><span class="o">)</span>
</span><span class='line'><span class="n">words</span> <span class="n">groupBy</span> <span class="o">{</span> <span class="n">word</span> <span class="k">=&gt;</span> <span class="n">word</span><span class="o">.</span><span class="n">toCharArray</span><span class="o">.</span><span class="n">sortWith</span><span class="o">(</span><span class="k">_</span> <span class="o">&lt;</span> <span class="k">_</span><span class="o">).</span><span class="n">mkString</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">)</span> <span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Group Anagrams [Coffeescript]</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'>  <span class="nv">words = </span><span class="p">[</span><span class="s">&quot;abc&quot;</span><span class="p">,</span> <span class="s">&quot;bca&quot;</span><span class="p">,</span> <span class="s">&quot;mkzp&quot;</span><span class="p">,</span> <span class="s">&quot;cba&quot;</span><span class="p">]</span>
</span><span class='line'>  <span class="nv">result = </span><span class="p">{}</span>
</span><span class='line'>  <span class="k">for</span> <span class="nx">word</span> <span class="k">in</span> <span class="nx">words</span>
</span><span class='line'>    <span class="nv">key = </span><span class="p">(</span><span class="nx">word</span><span class="p">.</span><span class="nx">split</span> <span class="s">&#39;&#39;</span><span class="p">).</span><span class="nx">sort</span><span class="p">().</span><span class="nx">join</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>    <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span><span class="o">?</span>
</span><span class='line'>    <span class="nx">result</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">push</span> <span class="nx">word</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>Group Anagrams [Ruby]</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">words</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;abc&quot;</span><span class="p">,</span> <span class="s2">&quot;bca&quot;</span><span class="p">,</span> <span class="s2">&quot;mkzp&quot;</span><span class="p">,</span> <span class="s2">&quot;cba&quot;</span><span class="o">]</span>
</span><span class='line'><span class="n">words</span><span class="o">.</span><span class="n">group_by</span> <span class="p">{</span> <span class="o">|</span><span class="n">w</span><span class="o">|</span> <span class="n">w</span><span class="o">.</span><span class="n">chars</span><span class="o">.</span><span class="n">sort</span><span class="o">.</span><span class="n">join</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/01/01/periodically-sending-jvm-stats-to-statsd-in-scala/">Periodically sending JVM stats to StatsD in Scala</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/21/using-bitsets-for-user-analytics/">Using BitSets for User Analytics</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/18/implementing-iterator-design-pattern-in-scala/">Implementing Iterator Design Pattern in Scala</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/10/custom-functions-in-hbase-shell/">Custom functions in HBase shell</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/01/09/group-anagram-puzzle-in-various-programming-languages/">Group Anagram puzzle in various programming languages</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - Parth Patil -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'parth-patils-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
